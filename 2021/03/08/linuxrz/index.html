

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>日志文件分析 [ Soymilk ]</title>
  
<link rel="shortcut icon" href="/favicon/favicon.ico">


<link rel="stylesheet" href="/lib/highlight/railscasts.css">


<link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css">


<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">

<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">


<link rel="stylesheet" href="/css/milk.css">


<meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="w啥都学" type="application/atom+xml">
</head>
<body>
  <div class="milk-header">
     

  <nav class="header-nav">
     
    <ul class="nav-menu">
      
        <li id="Home">
          <i class="fa fa-home" aria-hidden="true"></i>
          <a href="/ ">Home</a>
        </li>
      
        <li id="Archives">
          <i class="fa fa-archive" aria-hidden="true"></i>
          <a href="/archives ">Archives</a>
        </li>
      
        <li id="About">
          <i class="fa fa-user-circle" aria-hidden="true"></i>
          <a href="/about ">About</a>
        </li>
      
    </ul>
    
    
      <span class="nav-date">
        <i class="fa fa-calendar" aria-hidden="true"></i>
        <span id="date"></span>
      </span>
    
    
    
      <span class="nav-system" id="nav-system"></span>
    
    
    <span class="nav-access">
      <i class="fa fa-universal-access" id="nav-access"></i>
      <i class="fa fa-angle-down"></i>
      <div class="dropdown-content" id="dropdown-content">
        <ul class="social">
          
            <li>
              <a target="_blank" rel="noopener" href="https://github.com/MRsoymilk">
                <i class="fa fa-github-alt" aria-hidden="true"></i>
              </a>
            </li>
          
            <li>
              <a href="mailto:codermrsoymilk@gmail.com">
                <i class="fa fa-envelope" aria-hidden="true"></i>
              </a>
            </li>
          
        </ul>
        <ul>
          <li><span>Power by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a></span></li>
        </ul>
      </div>
    </span>
  </nav>
 
  </div>
  <div class="milk-body">
    
<div class="draggable-toc">
  <div class="toc-title">日志文件分析</div>
  <p>process: <span>0</span></p>
  <div class="progress-container">
    <div class="progress-bar" id="bar"></div>
  </div>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%B0%E5%BD%95%E7%9A%84%E4%BF%9D%E5%AD%98%E6%96%87%E4%BB%B6%E5%90%8D"><span class="toc-text">记录的保存文件名</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E7%9A%84%E7%A8%8B%E5%BA%8F"><span class="toc-text">记录日志文件的程序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rsyslog%E7%A8%8B%E5%BA%8F"><span class="toc-text">rsyslog程序</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%9C%89%E6%B2%A1%E6%9C%89%E5%BC%80%E5%90%AF"><span class="toc-text">服务有没有开启</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rsyslog%E7%A8%8B%E5%BA%8F%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">rsyslog程序修改配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8D%E7%A7%B0"><span class="toc-text">服务器名称</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E7%AD%89%E7%BA%A7"><span class="toc-text">信息等级</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#logrotate%E7%A8%8B%E5%BA%8F"><span class="toc-text">logrotate程序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#systemd%E7%A8%8B%E5%BA%8F"><span class="toc-text">systemd程序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F"><span class="toc-text">日志格式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E4%B8%AD%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82"><span class="toc-text">更新中。。。。。</span></a></li></ol>
</div>

<div class="post-content" id="post-content">
  <div id="top">日志文件分析</div>
  <div class="post">
    
    <div class="content-categories">
      
      <i class="fa fa-location-arrow"></i>
      <ul>
        <li>categories</li>
        
          <li>&gt;</li>
          <li>
            <a href="/categories/linux/">
          linux
        </a>
          </li>
      
      </ul>
    
    </div>
    <hr>
    
    <h1 id="记录的保存文件名"><a href="#记录的保存文件名" class="headerlink" title="记录的保存文件名"></a>记录的保存文件名</h1><ol>
<li><code>/var/log/boot.log</code>  电脑启动会叫日志信息会保存到这个文件里面，不会保存启动后的文件</li>
<li><code>/var/log/messages</code> 系统报错都会保存到这个文件里面</li>
<li><code>/var/log/lastlog</code>所有最近登录的信息</li>
<li><code>/var/log/cron</code>记录crontab</li>
<li><code>/var/log/dmesg</code>内核检查信息</li>
<li><code>/var/log/maillo``或 </code>/var/log/mail/`记录SMTP信息</li>
<li><code>/var/log/secure</code> 只要牵涉到“ 需要输入帐号密码”的软件</li>
<li><code>/var/log/wtmp</code>和<code>/var/log/faillog</code>记录登录成功和失败的账号信息</li>
</ol>
<h1 id="记录日志文件的程序"><a href="#记录日志文件的程序" class="headerlink" title="记录日志文件的程序"></a>记录日志文件的程序</h1><table>
<thead>
<tr>
<th align="left">程序名</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">rsyslog.service</td>
<td align="left">主要登录系统与网络等服务的讯息</td>
</tr>
<tr>
<td align="left">logrotate</td>
<td align="left">主要在进行登录文件的轮替功能</td>
</tr>
<tr>
<td align="left">systemd-journald.service</td>
<td align="left">最主要的讯息收受者,由 systemd 提供的</td>
</tr>
</tbody></table>
<h1 id="rsyslog程序"><a href="#rsyslog程序" class="headerlink" title="rsyslog程序"></a>rsyslog程序</h1><div class="note info simple"><p>这个程序是统一管理，记录日志</p>
</div>



<h2 id="服务有没有开启"><a href="#服务有没有开启" class="headerlink" title="服务有没有开启"></a>服务有没有开启</h2><p>命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep rsyslog </span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading2.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/wzass/giteezp/image-20210308142456616.png" alt="image-20210308142456616"></p>
<h1 id="rsyslog程序修改配置文件"><a href="#rsyslog程序修改配置文件" class="headerlink" title="rsyslog程序修改配置文件"></a>rsyslog程序修改配置文件</h1><div class="note info simple"><p><code>rsyslog.service</code>的配置文件在<code>/etc/rsyslog.conf</code></p>
<p>我们可以通过配置文件修改日志文件的保存的地方</p>
</div>

<p>看一下文件内容</p>
<p><img src= "/img/loading2.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/wzass/giteezp/image-20210308143139847.png" alt="image-20210308143139847"></p>
<div class="note info simple"><p>他的格式分三部分</p>
</div>

<ol>
<li>服务器名称</li>
<li>信息等级</li>
</ol>
<h2 id="服务器名称"><a href="#服务器名称" class="headerlink" title="服务器名称"></a>服务器名称</h2><div class="note info simple"><p><code>man  rsyslogd </code>这样可以了解他的配置的相关内容</p>
</div>

<div class="note info simple"><p>下面的内容都是linux内核syslog函数自行定制的服务名称</p>
</div>



<table>
<thead>
<tr>
<th>相对序号</th>
<th>服务类别</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>kern(kernel)</td>
<td>核心 (kernel) 产生的讯息，大部分都是硬件侦测以及核心功能的启用；</td>
</tr>
<tr>
<td>1</td>
<td>user</td>
<td>在用户层级所产生的信息，例如用户使用 logger 指令来记录登录文件的功能；</td>
</tr>
<tr>
<td>2</td>
<td>mail</td>
<td>只要与邮件收发有关的讯息记录都属于这个；</td>
</tr>
<tr>
<td>3</td>
<td>daemon</td>
<td>主要是系统的服务所产生的信息，例如 systemd 就是这个有关的讯息；</td>
</tr>
<tr>
<td>4</td>
<td>auth</td>
<td>主要与认证/授权有关的机制，例如 login, ssh, su 等需要账号/密码的操作；</td>
</tr>
<tr>
<td>5</td>
<td>syslog</td>
<td>由 syslog 相关协议产生的信息，其实就是 rsyslogd 这支程序本身产生的信息；</td>
</tr>
<tr>
<td>6</td>
<td>lpr</td>
<td>打印相关的讯息啊；</td>
</tr>
<tr>
<td>7</td>
<td>news</td>
<td>与新闻组服务器有关的信息；</td>
</tr>
<tr>
<td>8</td>
<td>uucp</td>
<td>全名为 Unix to Unix Copy Protocol，早期用于 unix 系统间的程序数据交换；</td>
</tr>
<tr>
<td>9</td>
<td>cron</td>
<td>例行性工作排程 cron/at 等产生的讯息记录；</td>
</tr>
<tr>
<td>10</td>
<td>authpriv</td>
<td>与 auth 类似，但记录较多账号私人的信息，包括 pam 模块的运作等；</td>
</tr>
<tr>
<td>11</td>
<td>ftp</td>
<td>与 FTP 通讯协议有关的讯息输出；</td>
</tr>
<tr>
<td>16-23</td>
<td>local0 ~ local7</td>
<td>保留给本机用户使用的一些登录文件讯息，较常与终端机互动。</td>
</tr>
</tbody></table>
<div class="note info simple"><p>软件开发者也可以通过上面的服务来定义自己的开发的软件，同时都调用syslog函数的mail服务名称</p>
</div>
<div class="note info simple"><p>上面的服务差异很打，比如mail服务多的要命，他会记录很多东西。这样的话我们就可以用其他的适合的服务进行记录日志</p>
</div>

<h2 id="信息等级"><a href="#信息等级" class="headerlink" title="信息等级"></a>信息等级</h2><div class="note info simple"><p>下面的是越靠近0问题越严重</p>
</div>

<table>
<thead>
<tr>
<th>等级数值</th>
<th>等级名称</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td>7</td>
<td>debug</td>
<td align="left">用来 debug (除错) 时产生的讯息数据；</td>
</tr>
<tr>
<td>6</td>
<td>info</td>
<td align="left">仅是一些基本的讯息说明而已；</td>
</tr>
<tr>
<td>5</td>
<td>notice</td>
<td align="left">虽然是正常信息，但比 info 还需要被注意到的一些信息内容；</td>
</tr>
<tr>
<td>4</td>
<td>warning</td>
<td align="left">(warn)警示的讯息，可能有问题，但是还不至于影响到某个 daemon 运作的信息；基本上， info,notice, warn 这三个讯息都是在告知一些基本信息而已，应该还不至于造成一些系统运作困扰；</td>
</tr>
<tr>
<td>3</td>
<td>err</td>
<td align="left">(error)一些重大的错误讯息，例如配置文件的某些设定值造成该服务无法启动的信息说明， 通常藉由 err 的错误告知，应该可以了解到该服务无法启动的问题；</td>
</tr>
<tr>
<td>2</td>
<td>crit</td>
<td align="left">比 error 还要严重的错误信息，这个 crit 是临界点 (critical) 的缩写，这个错误已经很严重了喔；</td>
</tr>
<tr>
<td>1</td>
<td>alert</td>
<td align="left">警告警告，已经很有问题的等级，比 crit 还要严重；</td>
</tr>
<tr>
<td>0</td>
<td>emerg</td>
<td align="left">(panic)等级，意指系统已经几乎要宕机的状态。 很严重的错误信息了。通常大概只有硬件出问题，导致整个核心无法顺利运作，就会出现这样的等级的讯息。</td>
</tr>
</tbody></table>
<div class="note info simple"><p>下面还有两个特殊的等级</p>
</div>



<table>
<thead>
<tr>
<th align="left">等级名称</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">debug</td>
<td align="left">错误检查等级</td>
</tr>
<tr>
<td align="left">nome</td>
<td align="left">不需登录等级</td>
</tr>
</tbody></table>
<div class="note info simple"><p>在信息等级前面还有一个连接符合下面的是他的意思</p>
</div>

<table>
<thead>
<tr>
<th align="left">连接符合</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>.</code></td>
<td align="left">代表比后面还要严重的等级 (含该等级) 都被记录下来的意思，例如： mail.info 代表只要是 mail的信息，而且该信息等级严重于 info (含 info 本身)时，就会被记录下来的意思</td>
</tr>
<tr>
<td align="left"><code>.=</code></td>
<td align="left">代表所需要的等级就是后面接的等级而已， 其他的不要</td>
</tr>
<tr>
<td align="left"><code>.!</code></td>
<td align="left">代表不等于， 即除了该等级外的其他等级都记录</td>
</tr>
</tbody></table>
<p>一般来说，我们比较常使用的是<code>.</code>这个链接符号</p>
<h1 id="logrotate程序"><a href="#logrotate程序" class="headerlink" title="logrotate程序"></a>logrotate程序</h1><div class="note info simple"><p>他是提供日志定期删除用的<br>就是将旧的登录文件更改名称,然后创建一个空的登录文件,如此一来, 新的登录文件将重新开始记录,然后他长时间了就会自动删除以前的文件</p>
</div>

<h1 id="systemd程序"><a href="#systemd程序" class="headerlink" title="systemd程序"></a>systemd程序</h1><p>经过systemd程序启动的服务他都会记录，他用的是systemd-journald.service 服务</p>
<h1 id="日志格式"><a href="#日志格式" class="headerlink" title="日志格式"></a>日志格式</h1><div class="note info simple"><p>他的格式是</p>
</div>

<ol>
<li>发生的时间</li>
<li>发生的事件的主机名</li>
<li>启动事件的服务名</li>
<li>产生的实际内容</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">~ » sudo cat  &#x2F;var&#x2F;log&#x2F;messages                                          </span><br><span class="line">[sudo] zss 的密码：        </span><br><span class="line">Mar  5 07:25:47 zss rsyslogd: [origin software&#x3D;&quot;rsyslogd&quot; swVersion&#x3D;&quot;8.2012.0&quot; x-pid&#x3D;&quot;657&quot; x-info&#x3D;&quot;https:&#x2F;&#x2F;www.rsyslog.com&quot;] rsyslogd was HUPed</span><br><span class="line">Mar  5 07:25:47 zss kernel: [    4.232728] EDAC amd64: F17h_M60h detected (node 0).</span><br><span class="line">Mar  5 07:25:47 zss kernel: [    4.232780] EDAC amd64: Node 0: DRAM ECC disabled.</span><br><span class="line">Mar  5 07:25:47 zss kernel: [    4.283804] r8169 0000:02:00.0 eth0: Link is Down</span><br><span class="line">Mar  5 07:25:47 zss kernel: [    4.341015] EDAC amd64: F17h_M60h detected (node 0).</span><br><span class="line">Mar  5 07:25:47 zss kernel: [    4.341063] EDAC amd64: Node 0: DRAM ECC disabled.</span><br><span class="line">Mar  5 07:25:47 zss kernel: [    4.413099] EDAC amd64: F17h_M60h detected </span><br></pre></td></tr></table></figure>
<p><strong>上面的意思</strong></p>
<div class="note info simple"><p><strong><code>Mar  5 07:25:47</code>的意思：</strong><code>Mar</code>是<code>三月</code>的意思，那<code>Mar  5 07:25:47</code>就是<code>3月5日07:25:47</code></p>
</div>

<div class="note info simple"><p><strong><code>zss</code>的意思：</strong>`使用的主机名</p>
</div>


<div class="note info simple"><p><strong><code>kernel</code>的意思：</strong>`程序名</p>
</div>


<div class="note info simple"><p><strong><code>[    4.232728] EDAC amd64: F17h_M60h detected (node 0)</code>的意思：</strong>`产生的实际内容</p>
</div>



<h1 id="更新中。。。。。"><a href="#更新中。。。。。" class="headerlink" title="更新中。。。。。"></a>更新中。。。。。</h1>
    
    <hr>
    <div class="content-tags">
      
      <i class="fa fa-tags"></i>
      <ul>
        
        <li><a href="/tags/linux/">
          linux
        </a></li>
      
      </ul>
    
    </div>
    
     
<div class="comment-tabs" id="comment-tabs">
  comment:
  <ul>
    
      <li><a href="#Valine">Valine</a></li>
    
    
      <li><a href="#LiveRe">LiveRe</a></li>
    
    
      <li><a href="#ChangYan">ChangYan</a></li>
    
  </ul>
  
  
    <div id="ChangYan">
      <!--PC和WAP自适应版-->
      <div id="SOHUCS" ></div> 
      <script type="text/javascript"> 
      (function(){ 
      var appid = 'cyuGH4lBk'; 
      var conf = 'ae32d85e4ca99348209aedfd3ae01478'; 
      var width = window.innerWidth || document.documentElement.clientWidth; 
      if (width < 960) {
      var head = document.getElementsByTagName('head')[0]||document.head||document.documentElement;
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.charset = 'utf-8';
      script.id = 'changyan_mobile_js';
      script.src = 'https://cy-cdn.kuaizhan.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf;
      head.appendChild(script);
      } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://cy-cdn.kuaizhan.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); 
      </script>
    </div>
   
  
  
    <div id="LiveRe">
      
        <!-- LiveRe City install code -->
        <div id="lv-container" data-id="city" data-uid="MTAyMC80NjA4MS8yMjU5Mg==">
          <script type="text/javascript">
            (function(d, s) {
              var j, e = d.getElementsByTagName(s)[0];
              if (typeof LivereTower === 'function') { return; }
              j = d.createElement(s);
              j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
              j.async = true;
              e.parentNode.insertBefore(j, e);
            })(document, 'script');
          </script>
          <noscript>Please activate JavaScript for write a comment in LiveRe</noscript>
          </div>
          <!-- completed City install code -->
        
    </div>
  
  
  
    <div id="Valine">
      <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
      <div id="vcomments"></div>
      <script>
        new Valine({
          el: '#vcomments',
          appId: '5bHFwYPW2iHWCiV7WmNRSenk-gzGzoHsz',
          appKey: '2q4UgVDTmeJf9Phe8VbnNKyC',
          avatar: 'monsterid',
          enableQQ: true
        })
      </script>
    </div>
   
</div>

  </div>
</div>
 
<div>
  <button id="scroll2top">back to top</button>
</div>
  </div>
  

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/jquery/jquery-ui.min.js"></script>


<script src="/lib/fancybox/jquery.fancybox.min.js"></script>



<script src="/lib/highlight/highlight.pack.js"></script>

<script>
  hljs.highlightAll();
</script>


<script src="/js/milk.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body>
</html>
